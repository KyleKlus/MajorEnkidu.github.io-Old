<header>
    <div class="back-button-container">
        <button class="back-button" onclick="location.href = '{{ page.backlink | default: / }}'">
            <-
        </button>
    </div>
    <h1>{{ page.title | default: site.title }}</h1>
    <div class="theme-toggle-container">
        <button class="theme-toggle">
            <img src="https://api.iconify.design/eva/sun-fill.svg?color=lightgray&width=24&height=24" alt="Cooking Ideas">
        </button>
    </div>


    <div class="menu-container is-visible" on="toggleMenu(this)">
        <button class="home" onclick="location.href = '/index.html'">
            <img src="https://api.iconify.design/bx/home-alt.svg?color=lightgray&width=28&height=28" alt="Home">
            <p class="nav-item">Home</p>
        </b>
        <button class="recipes" onclick="location.href = '/posts/recipes/Recipes.html'">
            <img src="https://api.iconify.design/icon-park-solid/fork-spoon.svg?color=lightgray&width=28&height=28" alt="Recipes">
            <p class="nav-item">Recipes</p>
        </b>
        <button class="cooking-idea" onclick="location.href = '/posts/recipes/etc/Cooking-Ideas.html'">
            <img src="https://api.iconify.design/carbon/idea.svg?color=lightgray&width=28&height=28" alt="Cooking Ideas">
            <p class="nav-item">Cooking Ideas</p>
        </button>
    </div>
    <script>
        const darkThemeClass = 'dark-theme';
        const lightThemeClass = 'light-theme';

        const toggleMenu = (visible) => {
            localStorage.setItem('menu-visible', visible ? 'true' : 'false');
            const menu = document.getElementsByClassName("menu-container")[0];
            if (visible) {
                menu.classList.add("is-visible");
            } else {
                menu.classList.remove("is-visible");
            }
        }

        function hasClass(element, className) {
            return (' ' + element.className + ' ').indexOf(' ' + className+ ' ') > -1;
        }

        function toggleButtonSrc(buttonImage, oldString, newString){
            buttonImage.src = buttonImage.src.replace(oldString, newString);
        }

        function toggleMenuSrc(menu, oldVal, newVal, oldThemeVal, newThemeVal) {
            let i = 0;
            for(; i < menu.childElementCount; i++){
                toggleButtonSrc(menu.children[i].children[0], oldVal, newVal);
            }
            var themeButton = document.getElementsByClassName("theme-toggle")[0];
            toggleButtonSrc(themeButton.children[0], oldThemeVal, newThemeVal);
            toggleButtonSrc(themeButton.children[0], oldVal, newVal);
        }

        const setTheme = (theme) => {
            localStorage.setItem('theme', theme ? 'light' : 'dark');

            const menu = document.getElementsByClassName("menu-container")[0];

            var i = 0;

            if (!theme) {
                toggleMenuSrc(menu, "black", "lightgray", "moon", "sun");
            } else {
                toggleMenuSrc(menu, "lightgray", "black", "sun", "moon");
            }

            document.body.classList.toggle(darkThemeClass, !theme);
            document.body.classList.toggle(lightThemeClass, theme);
        }

        const toggleTheme = () => {
            setTheme(document.body.classList.contains(darkThemeClass));
        }

        var menu = document.getElementsByClassName("menu-container")[0];
        menu.addEventListener('touchstart', handleTouchStart, false);
        menu.addEventListener('touchmove', handleTouchMove, false);

        var xDown = null;
        var yDown = null;

        function getTouches(evt) {
          return evt.touches ||             // browser API
                 evt.originalEvent.touches; // jQuery
        }

        function handleTouchStart(evt) {
            const firstTouch = getTouches(evt)[0];
            xDown = firstTouch.clientX;
            yDown = firstTouch.clientY;
        };

        function handleTouchMove(evt) {
            if ( ! xDown || ! yDown ) {
                return;
            }

            var xUp = evt.touches[0].clientX;
            var yUp = evt.touches[0].clientY;

            var xDiff = xDown - xUp;
            var yDiff = yDown - yUp;

            if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {/*most significant*/
                if ( xDiff > 0 ) {
                    /* right swipe */
                } else {
                    /* left swipe */
                }
            } else {
                if ( yDiff > 0 ) {
                    toggleMenu(true);
                } else {
                    toggleMenu(false);
                }
            }
            /* reset values */
            xDown = null;
            yDown = null;
        };

        var button = document.getElementsByClassName("theme-toggle")[0];

        button.addEventListener('click', toggleTheme);

        (() => localStorage.getItem('theme') === 'dark' && setTheme(false))();
        (() => localStorage.getItem('theme') === 'light' && setTheme(true))();
        (() => localStorage.getItem('menu-visible') === 'true' && toggleMenu(true))();
        (() => localStorage.getItem('menu-visible') === 'false' && toggleMenu(false))();

    </script>
</header>